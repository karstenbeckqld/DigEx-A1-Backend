/*--------------------------------------------------------------------------------------------------------------------*/
/*                                                   SERVER                                                           */
/*--------------------------------------------------------------------------------------------------------------------*/


/*--------------------------------------------------------------------------------------------------------------------*/
/*                                                Dependencies                                                        */
/*--------------------------------------------------------------------------------------------------------------------*/
require('dotenv').config()
require('crypto').randomBytes(64).toString('hex')
const bodyParser = require('body-parser')
const express = require('express')
const expressLayouts = require('express-ejs-layouts')
const mongoose = require('mongoose').default
const cors = require('cors')
const port = process.env.PORT || 3000


/*--------------------------------------------------------------------------------------------------------------------*/
/*                                             Database Connection                                                    */
/*--------------------------------------------------------------------------------------------------------------------*/
mongoose.connect(process.env.DATABASE_URL, {dbName: 'assessmentOne'})
const db = mongoose.connection
db.on('error', error => console.log(error))
db.once('open', () => console.log('Connected to Mongoose'))

/*--------------------------------------------------------------------------------------------------------------------*/
/*                                             Express App Setup                                                      */
/*--------------------------------------------------------------------------------------------------------------------*/
const app = express()

/*--------------------------------------------------------------------------------------------------------------------*/
/*                                               Views Settings                                                       */
/*--------------------------------------------------------------------------------------------------------------------*/
app.set('view engine', 'ejs')
app.set('views', __dirname + '/views')
app.set('layout', 'layouts/layout')

/*--------------------------------------------------------------------------------------------------------------------*/
/*                                                 App Uses                                                           */
/*--------------------------------------------------------------------------------------------------------------------*/
app.use(bodyParser.json())
app.use(bodyParser.urlencoded({extended: true}))
app.use('*', cors())
app.use(expressLayouts)

/*--------------------------------------------------------------------------------------------------------------------*/
/*                                              Homepage Route                                                        */
/*--------------------------------------------------------------------------------------------------------------------*/
app.get('/api', (req, res) => {
    res.send('This is the homepage')
    //res.render('pages/index')
})

/*--------------------------------------------------------------------------------------------------------------------*/
/*                                                 User Route                                                         */
/*--------------------------------------------------------------------------------------------------------------------*/
const userRouter = require('./routes/user');
app.use('/api/user', userRouter);

/*--------------------------------------------------------------------------------------------------------------------*/
/*                                                 Auth Route                                                         */
/*--------------------------------------------------------------------------------------------------------------------*/
const authRouter = require('./routes/auth')
app.use('/api/auth', authRouter)

/*--------------------------------------------------------------------------------------------------------------------*/
/*                                                     Run                                                            */
/*--------------------------------------------------------------------------------------------------------------------*/
app.listen(port, () => {
    console.log('App is running on port ', port)
})