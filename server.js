/*--------------------------------------------------------------------------------------------------------------------*/
/*---------------------------------------                Server                ---------------------------------------*/
/*--------------------------------------------------------------------------------------------------------------------*/

/*--------------------------------------------------------------------------------------------------------------------*/
/*                                                Dependencies                                                        */
/*--------------------------------------------------------------------------------------------------------------------*/
require('dotenv').config();
require('crypto').randomBytes(64).toString('hex');
const bodyParser = require('body-parser');
const express = require('express');
const expressLayouts = require('express-ejs-layouts');
const mongoose = require('mongoose').default;
const cors = require('cors');
const port = process.env.PORT || 3000;

/*--------------------------------------------------------------------------------------------------------------------*/
/*                                             Express App Setup                                                      */
/*--------------------------------------------------------------------------------------------------------------------*/
const app = express();

/*--------------------------------------------------------------------------------------------------------------------*/
/*                                             Database Connection                                                    */
/*--------------------------------------------------------------------------------------------------------------------*/
mongoose.connect(process.env.DATABASE_URL, {dbName: 'assessmentOne'})
.then((result) => app.listen(port, () => {console.log(`Server running on ${port}.`)}))
.catch((err)=> console.log(err));

/*--------------------------------------------------------------------------------------------------------------------*/
/*                                                 Middleware                                                         */
/*--------------------------------------------------------------------------------------------------------------------*/
app.use(express.static('public'))

/*--------------------------------------------------------------------------------------------------------------------*/
/*                                               Views Settings                                                       */
/*--------------------------------------------------------------------------------------------------------------------*/
app.set('view engine', 'ejs')
app.set('views', __dirname + '/views')
app.set('layout', 'layouts/layout')

/*--------------------------------------------------------------------------------------------------------------------*/
/*                                                 App Uses                                                           */
/*--------------------------------------------------------------------------------------------------------------------*/
app.use(bodyParser.json())
app.use(bodyParser.urlencoded({extended: true}))
app.use('*', cors())
app.use(expressLayouts)

/*--------------------------------------------------------------------------------------------------------------------*/
/*                                              Homepage Route                                                        */
/*--------------------------------------------------------------------------------------------------------------------*/
app.get('/api', (req, res) => {
    res.send('This is the homepage')
    //res.render('pages/index')
})

/*--------------------------------------------------------------------------------------------------------------------*/
/*                                                 User Route                                                         */
/*--------------------------------------------------------------------------------------------------------------------*/
const userRouter = require('./routes/user');
app.use('/user', userRouter);

/*--------------------------------------------------------------------------------------------------------------------*/
/*                                                 Auth Route                                                         */
/*--------------------------------------------------------------------------------------------------------------------*/
const authRouter = require('./routes/auth')
app.use('/auth', authRouter)

/*--------------------------------------------------------------------------------------------------------------------*/
/*                                                     Run                                                            */
/*--------------------------------------------------------------------------------------------------------------------*/
/* app.listen(port, () => {
    console.log('App is running on port ', port)
}) */